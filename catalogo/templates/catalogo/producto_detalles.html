{% extends 'core/base.html' %}
{% load humanize %}
{% load filtros_extra %}
{% block title %}{{ producto.nombre }} - Auka Terapias{% endblock %}

{% block content %}
<article class="card">
    <h1>{{ producto.nombre }}</h1>

    {% if producto.imagen %}
        <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}">
    {% endif %}

    <p>{{ producto.descripcion }}</p>

    <p class="meta">
        Categoría: {{ producto.categoria.nombre }} ·
        Stock: {{ producto.stock }}
    </p>

    <p><strong>{{ producto.precio|clp }}</strong></p>

    <div class="card-footer" style="align-items: flex-end;"> {% if user.is_authenticated %}
            {% if producto.activo and producto.stock > 0 %}
                
                <form action="{% url 'carrito:cart_add' producto.pk %}" method="post" class="add-to-cart-form">
                    {% csrf_token %}
                    
                    <div class="quantity-wrapper">
                        <label for="cantidad" style="font-size: 0.9rem; color: #666;">Cantidad:</label>
                        <input type="number" id="cantidad" name="cantidad" value="1" min="1" max="{{ producto.stock }}" class="quantity-input">
                    </div>

                    <button type="submit" class="btn btn-primary">
                        Añadir al carrito
                    </button>
                </form>
                {% endif %}
        {% else %}
            <a href="{% url 'login:login' %}" class="btn btn-primary">
                Inicia sesión para comprar
            </a>
        {% endif %}

        <a href="{% url 'catalogo:producto_lista' %}" class="btn btn-ghost">
            ← Volver al catálogo
        </a>

        {% if user.is_staff %}
            <span class="meta">
                <a href="{% url 'catalogo:product_update' producto.pk %}">Editar</a> ·
                <a href="{% url 'catalogo:product_delete' producto.pk %}">Eliminar</a>
            </span>
        {% endif %}
    </div>
</article>
{% endblock %}